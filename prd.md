# VoxType - AI 语音输入法 PRD

> 产品需求文档 v1.0
> 最后更新: 2026-01-30

---

## 1. 产品概述

### 1.1 产品定位

VoxType 是一款基于 macOS 和 iOS 平台的现代化 AI 语音转写与输入工具，通过集成先进的语音识别模型（Whisper 等），提供高精度的语音转文字体验，并结合 AI 对文本进行智能润色和处理。

### 1.2 核心价值主张

```
┌─────────────────────────────────────────────────────────────┐
│                    VoxType 核心价值                        │
├─────────────────────────────────────────────────────────────┤
│  🎯 精准转写    │  基于 Whisper v3 Turbo，中英混杂识别率 >95% │
│  🤖 AI 增强     │  语音 → AI 润色 → 自动输入 一体化工作流      │
│  📱 跨设备协同  │  iPhone 作为 Mac 的无线麦克风                │
│  🔒 隐私优先    │  支持完全本地运行，数据不出设备              │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 目标用户

| 用户群体    | 典型场景                         | 核心诉求                     |
| ----------- | -------------------------------- | ---------------------------- |
| 开发者      | 写代码注释、Git Commit、技术文档 | 快速将口语化想法转为规范文本 |
| 内容创作者  | 写文章、脚本、社交媒体内容       | 语音输入 + AI 润色提升效率   |
| 商务人士    | 邮件、会议纪要、报告             | 口述要点自动生成正式文档     |
| 学生/研究者 | 论文、笔记、文献整理             | 长音频转录 + 内容整理        |

### 1.4 竞品对比

| 特性          | VoxType | Spokenly | MacWhisper | Superwhisper |
| ------------- | --------- | -------- | ---------- | ------------ |
| 本地 Whisper  | ✅        | ✅       | ✅         | ✅           |
| AI 润色工作流 | ✅        | ✅       | ❌         | 部分         |
| 跨设备麦克风  | ✅        | ✅       | ❌         | ❌           |
| 自定义 Prompt | ✅        | ✅       | ❌         | ✅           |
| 买断制选项    | ✅        | ❌       | ✅         | ✅           |
| 开源可控      | ✅        | ❌       | ❌         | ❌           |

---

## 2. 功能需求

### 2.1 功能架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        VoxType 功能架构                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   输入层     │  │   处理层     │  │   输出层     │          │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤          │
│  │ • 实时录音   │  │ • 语音识别   │  │ • 自动输入   │          │
│  │ • 文件导入   │  │ • AI 润色    │  │ • 剪贴板     │          │
│  │ • 跨设备麦克风│  │ • 词替换     │  │ • 历史管理   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                      协同层                               │  │
│  │  • iCloud 同步  • Bonjour 局域网发现  • 蓝牙配对          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心功能清单

#### P0 - 必须有 (MVP)

| ID  | 功能              | 描述                                | 验收标准                              |
| --- | ----------------- | ----------------------------------- | ------------------------------------- |
| F01 | 实时语音转写      | 按住/切换快捷键录音，实时转写为文字 | 延迟 < 500ms，准确率 > 90%            |
| F02 | 本地 Whisper 引擎 | 集成 whisper.cpp，支持多种模型      | 支持 tiny/base/small/medium/large     |
| F03 | 自动文本输入      | 转写结果自动输入到当前光标位置      | 支持粘贴(CMD+V)和模拟键盘输入两种模式 |
| F04 | 全局快捷键        | 系统级快捷键唤醒录音                | 支持 Fn/Option/Control 等修饰键       |
| F05 | 状态栏应用        | macOS 菜单栏常驻图标                | 显示录音状态、快速访问设置            |

#### P1 - 应该有

| ID  | 功能           | 描述                                | 验收标准                            |
| --- | -------------- | ----------------------------------- | ----------------------------------- |
| F06 | AI 润色 Prompt | 自定义 AI Prompt 对转写文本进行处理 | 支持多个 Prompt 模板切换            |
| F07 | 跨设备麦克风   | iPhone 作为 Mac 的无线麦克风        | 延迟 < 100ms，同一 WiFi 下自动发现  |
| F08 | 云端模型支持   | 接入 OpenAI Whisper API、GPT-4o 等  | 可配置 API Key，支持自定义 endpoint |
| F09 | 历史记录管理   | 保存所有转写记录，支持搜索和分类    | 支持全部/听写/文件/日记分类         |
| F10 | 文件转录       | 拖拽音视频文件批量转写              | 支持 MP3/WAV/M4A/FLAC/MP4/MOV       |

#### P2 - 可以有

| ID  | 功能       | 描述                         | 验收标准                 |
| --- | ---------- | ---------------------------- | ------------------------ |
| F11 | 多语言支持 | 自动检测语言，支持中英日韩等 | 自动语言检测准确率 > 85% |
| F12 | 词替换规则 | 自定义词汇替换映射表         | 支持正则表达式           |
| F13 | 界面主题   | 支持面板/刘海两种显示模式    | 跟随系统深色/浅色        |
| F14 | 触控板反馈 | 录音时提供触觉反馈           | 可开关                   |
| F15 | 导出功能   | 导出历史记录为 TXT/MD/JSON   | 支持批量导出             |

---

## 3. 跨设备协同方案

### 3.1 技术架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      跨设备协同架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────┐                      ┌─────────────┐         │
│   │   iPhone    │    ◀──── WiFi ────▶  │    Mac      │         │
│   │   (Client)  │                      │   (Server)  │         │
│   ├─────────────┤                      ├─────────────┤         │
│   │ • 录音采集  │                      │ • 音频接收  │         │
│   │ • 音频编码  │                      │ • 语音识别  │         │
│   │ • 状态同步  │                      │ • AI 处理   │         │
│   │ • UI 展示   │                      │ • 文本输入  │         │
│   └─────────────┘                      └─────────────┘         │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    通信协议栈                            │  │
│   ├─────────────────────────────────────────────────────────┤  │
│   │  发现层: Bonjour (mDNS) - 局域网自动发现                 │  │
│   │  传输层: WebSocket over TLS - 低延迟双向通信             │  │
│   │  编码层: Opus Codec - 高质量低带宽音频压缩               │  │
│   │  同步层: iCloud KeyValueStore - 配置同步                 │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 配对流程

```
iPhone                                           Mac
   │                                              │
   │  1. 扫描二维码 / 输入配对码                    │
   │ ──────────────────────────────────────────▶ │
   │                                              │
   │  2. 返回 WebSocket 连接地址 + Token           │
   │ ◀────────────────────────────────────────── │
   │                                              │
   │  3. 建立加密 WebSocket 连接                   │
   │ ◀═══════════════════════════════════════════▶│
   │                                              │
   │  4. 实时音频流传输                            │
   │ ══════════════════════════════════════════▶ │
   │                                              │
   │  5. 转写结果 & 状态同步                       │
   │ ◀────────────────────────────────────────── │
```

### 3.3 数据同步策略

| 数据类型   | 同步方式        | 同步频率 |
| ---------- | --------------- | -------- |
| 用户设置   | iCloud KVS      | 即时     |
| AI Prompt  | iCloud KVS      | 即时     |
| 历史记录   | iCloud CloudKit | 5分钟    |
| 词替换规则 | iCloud KVS      | 即时     |

---

## 4. 技术架构

### 4.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        技术架构总览                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                      macOS App                             │ │
│  ├───────────────────────────────────────────────────────────┤ │
│  │  UI Layer        │  SwiftUI + AppKit (状态栏/悬浮窗)       │ │
│  │  Business Layer  │  Swift Concurrency (async/await)       │ │
│  │  Audio Layer     │  AVFoundation + AudioToolbox           │ │
│  │  ASR Engine      │  whisper.cpp (Metal 加速)              │ │
│  │  AI Layer        │  OpenAI API / Ollama (本地 LLM)        │ │
│  │  Storage Layer   │  SwiftData + iCloud                    │ │
│  │  Network Layer   │  Network.framework (WebSocket)         │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                      iOS App                               │ │
│  ├───────────────────────────────────────────────────────────┤ │
│  │  UI Layer        │  SwiftUI                               │ │
│  │  Audio Layer     │  AVAudioSession + AudioUnit            │ │
│  │  Network Layer   │  Network.framework (WebSocket)         │ │
│  │  Sync Layer      │  iCloud KVS                            │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 核心技术选型

| 模块     | 技术方案               | 选型理由                        |
| -------- | ---------------------- | ------------------------------- |
| 语音识别 | whisper.cpp + Metal    | 高精度、支持 Apple Silicon 加速 |
| AI 润色  | OpenAI GPT-4o / Claude | 多语言支持、高质量文本生成      |
| 本地 LLM | Ollama + Llama 3       | 隐私保护、离线可用              |
| 音频编码 | Opus                   | 低延迟、高压缩比                |
| 设备发现 | Bonjour (mDNS)         | 苹果生态原生支持                |
| 实时通信 | WebSocket              | 低延迟双向通信                  |
| 数据存储 | SwiftData              | 现代 Swift 原生方案             |
| 云同步   | iCloud                 | 苹果生态无缝集成                |

### 4.3 Whisper 模型配置

| 模型           | 大小   | VRAM   | 适用场景           |
| -------------- | ------ | ------ | ------------------ |
| tiny           | 75 MB  | ~1 GB  | 快速草稿、低端设备 |
| base           | 142 MB | ~1 GB  | 日常使用平衡       |
| small          | 466 MB | ~2 GB  | 推荐默认选项       |
| medium         | 1.5 GB | ~5 GB  | 高精度需求         |
| large-v3       | 3.1 GB | ~10 GB | 专业级转录         |
| large-v3-turbo | 1.6 GB | ~6 GB  | 速度与精度最佳平衡 |

---

## 5. 用户界面设计

### 5.1 macOS 界面结构

```
┌─────────────────────────────────────────────────────────────────┐
│  macOS 主界面 (设置窗口)                                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┬──────────────────────────────────────────┐   │
│  │   侧边栏     │              内容区                        │   │
│  ├──────────────┼──────────────────────────────────────────┤   │
│  │ 📱 iOS 应用  │                                          │   │
│  │ ⚙️ 设置  │   [根据侧边栏选项显示对应内容]              │   │
│  │ 🎙️ 听写模型  │                                          │   │
│  │ 📁 转录文件  │                                          │   │
│  │ 🕐 历史记录  │                                          │   │
│  │ ⌨️ 快捷键   │                                          │   │
│  │ 🤖 AI 提示  │                                          │   │
│  │ ✉️ 联系我们  │                                          │   │
│  ├──────────────┤                                          │   │
│  │ [升级 Pro]   │                                          │   │
│  └──────────────┴──────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 录音状态显示

```
┌─────────────────────────────────────┐
│  模式 A: 面板模式 (悬浮窗)           │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │  🎙️ VoxType              │   │
│  │  ════════════════════      │   │
│  │  正在录音...                │   │
│  │  "今天天气真不错"           │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  模式 B: 刘海模式 (状态栏)           │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ 🔴 录音中 │ 2.3s │ 16字     │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

### 5.3 iOS 界面结构

```
┌─────────────────────────────────────┐
│           VoxType iOS             │
├─────────────────────────────────────┤
│                                     │
│   ┌─────────────────────────────┐  │
│   │      已连接: MacBook Pro    │  │
│   │          ● 在线             │  │
│   └─────────────────────────────┘  │
│                                     │
│   ┌─────────────────────────────┐  │
│   │                             │  │
│   │      ┌─────────────┐       │  │
│   │      │             │       │  │
│   │      │   🎙️ 按住   │       │  │
│   │      │    录音     │       │  │
│   │      │             │       │  │
│   │      └─────────────┘       │  │
│   │                             │  │
│   └─────────────────────────────┘  │
│                                     │
│   ┌─────────────────────────────┐  │
│   │  最近转写:                  │  │
│   │  "这是一段测试文字..."      │  │
│   └─────────────────────────────┘  │
│                                     │
│   ┌────┐  ┌────┐  ┌────┐  ┌────┐  │
│   │设置│  │历史│  │配对│  │帮助│  │
│   └────┘  └────┘  └────┘  └────┘  │
│                                     │
└─────────────────────────────────────┘
```

---

## 6. 数据模型

### 6.1 核心实体

```swift
// 转写记录
struct Transcription {
    let id: UUID
    let content: String           // 原始转写文本
    let enhancedContent: String?  // AI 润色后文本
    let audioURL: URL?            // 音频文件路径
    let duration: TimeInterval    // 录音时长
    let source: Source            // 来源: dictation/file/diary
    let model: String             // 使用的模型
    let language: String?         // 检测到的语言
    let createdAt: Date
    let deviceId: String          // 来源设备
}

// AI Prompt 模板
struct AIPrompt {
    let id: UUID
    let name: String              // 模板名称
    let prompt: String            // Prompt 内容
    let shortcut: String?         // 快捷键
    let isDefault: Bool
    let createdAt: Date
}

// 词替换规则
struct WordReplacement {
    let id: UUID
    let pattern: String           // 匹配模式
    let replacement: String       // 替换内容
    let isRegex: Bool
    let isEnabled: Bool
}

// 设备配对
struct PairedDevice {
    let id: UUID
    let name: String
    let deviceType: DeviceType    // mac/iphone/ipad
    let lastConnected: Date
    let token: String
}
```

---

## 7. API 设计

### 7.1 跨设备通信协议

```json
// 配对请求
{
  "type": "pair_request",
  "deviceId": "iPhone-xxx",
  "deviceName": "My iPhone",
  "timestamp": 1706572800
}

// 音频数据包
{
  "type": "audio_data",
  "sessionId": "sess-xxx",
  "sequence": 42,
  "data": "<base64 encoded opus audio>",
  "timestamp": 1706572801
}

// 转写结果
{
  "type": "transcription_result",
  "sessionId": "sess-xxx",
  "text": "你好世界",
  "isFinal": true,
  "confidence": 0.95
}

// 状态同步
{
  "type": "status_sync",
  "recording": true,
  "model": "whisper-large-v3-turbo",
  "aiPrompt": "default"
}
```

### 7.2 AI 润色接口

```swift
protocol AIEnhancer {
    func enhance(
        text: String,
        prompt: AIPrompt,
        context: EnhanceContext?
    ) async throws -> String
}

struct EnhanceContext {
    let previousText: String?     // 上一段文本
    let appName: String?          // 当前活跃应用
    let language: String?
}
```

---

## 8. 非功能需求

### 8.1 性能要求

| 指标       | 目标值  | 测量方法             |
| ---------- | ------- | -------------------- |
| 转写延迟   | < 500ms | 从说话结束到文字出现 |
| 跨设备延迟 | < 100ms | 音频传输延迟         |
| 内存占用   | < 500MB | 空闲状态             |
| 电池影响   | < 5%/h  | 持续录音状态         |
| 冷启动时间 | < 2s    | 从点击到可用         |
| 模型加载   | < 3s    | small 模型           |

### 8.2 安全要求

| 要求         | 实现方案                         |
| ------------ | -------------------------------- |
| 音频数据加密 | TLS 1.3 端到端加密               |
| API Key 存储 | Keychain 安全存储                |
| 隐私合规     | 麦克风权限明确申请，本地处理优先 |
| 数据保留     | 用户可控删除历史记录             |

### 8.3 兼容性要求

| 平台  | 最低版本                              |
| ----- | ------------------------------------- |
| macOS | 14.0 (Sonoma)                         |
| iOS   | 17.0                                  |
| 芯片  | Apple Silicon (M1+) / Intel with AVX2 |

---

## 9. 开发里程碑

### 9.1 版本规划

```
┌─────────────────────────────────────────────────────────────────┐
│                        版本规划路线图                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  v0.1 MVP ─────────────────────────────────────────────────▶   │
│  │ • 本地 Whisper 转写                                         │
│  │ • 全局快捷键                                                 │
│  │ • 自动文本输入                                               │
│  │ • 状态栏应用                                                 │
│                                                                 │
│  v0.2 AI 增强 ──────────────────────────────────────────────▶  │
│  │ • AI Prompt 润色                                            │
│  │ • 云端模型支持                                               │
│  │ • 历史记录管理                                               │
│                                                                 │
│  v0.3 跨设备 ───────────────────────────────────────────────▶  │
│  │ • iOS 配套应用                                               │
│  │ • iPhone 作为麦克风                                          │
│  │ • iCloud 同步                                                │
│                                                                 │
│  v0.4 进阶功能 ─────────────────────────────────────────────▶  │
│  │ • 文件批量转录                                               │
│  │ • 词替换规则                                                 │
│  │ • 多语言优化                                                 │
│                                                                 │
│  v1.0 正式发布 ─────────────────────────────────────────────▶  │
│  │ • 完整功能                                                   │
│  │ • App Store 上架                                             │
│  │ • 商业化方案                                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 9.2 MVP 功能拆分

| 任务                        | 优先级 | 依赖              |
| --------------------------- | ------ | ----------------- |
| 搭建 macOS SwiftUI 项目骨架 | P0     | -                 |
| 集成 whisper.cpp            | P0     | 项目骨架          |
| 实现音频录制模块            | P0     | 项目骨架          |
| 实现全局快捷键监听          | P0     | 项目骨架          |
| 实现状态栏菜单              | P0     | 项目骨架          |
| 实现自动文本输入            | P0     | 快捷键监听        |
| 实现转写流程串联            | P0     | 录制+Whisper+输入 |
| 基础设置界面                | P1     | 转写流程          |

---

## 10. 商业模式

### 10.1 定价策略

```
┌─────────────────────────────────────────────────────────────────┐
│                        定价方案对比                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │     Free        │  │      Pro        │  │    Lifetime     │ │
│  │     免费版      │  │     专业版      │  │     终身版      │ │
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤ │
│  │  ¥0            │  │  ¥38/月         │  │  ¥298 一次性    │ │
│  │                 │  │  ¥198/年        │  │                 │ │
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤ │
│  │ ✅ 本地转写     │  │ ✅ 所有免费功能 │  │ ✅ 所有 Pro 功能│ │
│  │ ✅ tiny/base   │  │ ✅ 所有模型     │  │ ✅ 永久更新     │ │
│  │ ✅ 基础快捷键  │  │ ✅ AI 润色      │  │ ✅ 优先支持     │ │
│  │ ❌ 跨设备      │  │ ✅ 跨设备协同   │  │                 │ │
│  │ ❌ AI 润色     │  │ ✅ 云端模型     │  │                 │ │
│  │ ❌ 历史记录    │  │ ✅ 无限历史     │  │                 │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 10.2 差异化卖点

相比 Spokenly (¥68/月):

- **更低价格**: 月费约为竞品的 55%
- **买断选项**: 终身版满足一次性付费需求
- **本地优先**: 免费版也能使用完整的本地转写
- **开发者友好**: 支持自定义 API endpoint

---

## 11. 风险与对策

| 风险                 | 影响         | 对策                              |
| -------------------- | ------------ | --------------------------------- |
| Whisper.cpp 性能不足 | 用户体验差   | 使用 Metal 加速，提供多模型选择   |
| 跨设备延迟过高       | 协同功能鸡肋 | 使用 Opus 编码，局域网直连        |
| Apple 审核政策       | 无法上架     | 遵循 App Store 指南，避免私有 API |
| 竞品降价             | 价格优势消失 | 持续功能迭代，建立品牌认知        |

---

## 12. 待确认事项

- [ ] 产品命名: VoxType / VoiceNote / SpeakType / ?
- [ ] 是否支持 Intel Mac？
- [ ] AI 润色是否需要自建后端？还是纯客户端调用？
- [ ] 是否需要用户账号系统？还是纯 iCloud 同步？
- [ ] MVP 阶段是否需要 iOS 应用？

---

## 附录

### A. 参考资料

- [whisper.cpp GitHub](https://github.com/ggerganov/whisper.cpp)
- [Apple AVFoundation](https://developer.apple.com/av-foundation/)
- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)
- [Spokenly 官网](https://spokenly.app)

### B. 术语表

| 术语 | 定义                                        |
| ---- | ------------------------------------------- |
| ASR  | Automatic Speech Recognition，自动语音识别  |
| STT  | Speech-to-Text，语音转文字                  |
| VAD  | Voice Activity Detection，语音活动检测      |
| Opus | 一种高效的音频编解码器                      |
| mDNS | Multicast DNS，多播 DNS，用于局域网服务发现 |
